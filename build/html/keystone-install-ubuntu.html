<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Install and configure &#8212; doczhao 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">doczhao 1.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="install-and-configure">
<h1>Install and configure<a class="headerlink" href="#install-and-configure" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to install and configure the OpenStack
Identity service, code-named keystone, on the controller node. For
scalability purposes, this configuration deploys Fernet tokens and
the Apache HTTP server to handle requests.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before you install and configure the Identity service, you must
create a database.</p>
<ol class="arabic">
<li><p class="first">Use the database access client to connect to the database
server as the <code class="docutils literal"><span class="pre">root</span></code> user:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> mysql
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><p class="first">Create the <code class="docutils literal"><span class="pre">keystone</span></code> database:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">MariaDB [(none)]&gt; CREATE DATABASE keystone;</span>
</pre></div>
</div>
</li>
<li><p class="first">Grant proper access to the <code class="docutils literal"><span class="pre">keystone</span></code> database:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;localhost&#39; \</span>
<span class="go">IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;</span>
<span class="go">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;%&#39; \</span>
<span class="go">IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">KEYSTONE_DBPASS</span></code> with a suitable password.</p>
</li>
<li><p class="first">Exit the database access client.</p>
</li>
</ol>
</div>
<div class="section" id="install-and-configure-components">
<span id="keystone-install-configure-ubuntu"></span><h2>Install and configure components<a class="headerlink" href="#install-and-configure-components" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Default configuration files vary by distribution. You might need
to add these sections and options rather than modifying existing
sections and options. Also, an ellipsis (<code class="docutils literal"><span class="pre">...</span></code>) in the configuration
snippets indicates potential default configuration options that you
should retain.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This guide uses the Apache HTTP server with <code class="docutils literal"><span class="pre">mod_wsgi</span></code> to serve
Identity service requests on ports 5000 and 35357. By default, the
keystone service still listens on these ports. The package handles
all of the Apache configuration for you (including the activation of
the <code class="docutils literal"><span class="pre">mod_wsgi</span></code> apache2 module and keystone configuration in Apache).</p>
</div>
<ol class="arabic">
<li><p class="first">Run the following command to install the packages:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> apt install keystone  apache2 libapache2-mod-wsgi
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><p class="first">Edit the <code class="docutils literal"><span class="pre">/etc/keystone/keystone.conf</span></code> file and complete the following
actions:</p>
<ul>
<li><p class="first">In the <code class="docutils literal"><span class="pre">[database]</span></code> section, configure database access:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[database]</span>
<span class="c1"># ...</span>
<span class="na">connection</span> <span class="o">=</span> <span class="s">mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">KEYSTONE_DBPASS</span></code> with the password you chose for the database.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Comment out or remove any other <code class="docutils literal"><span class="pre">connection</span></code> options in the
<code class="docutils literal"><span class="pre">[database]</span></code> section.</p>
</div>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">[token]</span></code> section, configure the Fernet token provider:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[token]</span>
<span class="c1"># ...</span>
<span class="na">provider</span> <span class="o">=</span> <span class="s">fernet</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Populate the Identity service database:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> su -s /bin/sh -c <span class="s2">&quot;keystone-manage db_sync&quot;</span> keystone
</pre></div>
</div>
</li>
<li><p class="first">Initialize Fernet key repositories:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
<span class="gp">#</span> keystone-manage credential_setup --keystone-user keystone --keystone-group keystone
</pre></div>
</div>
</li>
<li><p class="first">Bootstrap the Identity service:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> keystone-manage bootstrap --bootstrap-password ADMIN_PASS <span class="se">\</span>
  --bootstrap-admin-url http://controller:35357/v3/ <span class="se">\</span>
  --bootstrap-internal-url http://controller:5000/v3/ <span class="se">\</span>
  --bootstrap-public-url http://controller:5000/v3/ <span class="se">\</span>
  --bootstrap-region-id RegionOne
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">ADMIN_PASS</span></code> with a suitable password for an administrative user.</p>
</li>
</ol>
</div>
<div class="section" id="configure-the-apache-http-server">
<h2>Configure the Apache HTTP server<a class="headerlink" href="#configure-the-apache-http-server" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Edit the <code class="docutils literal"><span class="pre">/etc/apache2/apache2.conf</span></code> file and configure the
<code class="docutils literal"><span class="pre">ServerName</span></code> option to reference the controller node:</p>
<div class="highlight-apache"><div class="highlight"><pre><span></span><span class="nb">ServerName</span> controller
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="finalize-the-installation">
<h2>Finalize the installation<a class="headerlink" href="#finalize-the-installation" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Restart the Apache service:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> service apache2 restart
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><p class="first">Configure the administrative account</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">export</span> <span class="nv">OS_USERNAME</span><span class="o">=</span>admin
<span class="gp">$</span> <span class="nb">export</span> <span class="nv">OS_PASSWORD</span><span class="o">=</span>ADMIN_PASS
<span class="gp">$</span> <span class="nb">export</span> <span class="nv">OS_PROJECT_NAME</span><span class="o">=</span>admin
<span class="gp">$</span> <span class="nb">export</span> <span class="nv">OS_USER_DOMAIN_NAME</span><span class="o">=</span>Default
<span class="gp">$</span> <span class="nb">export</span> <span class="nv">OS_PROJECT_DOMAIN_NAME</span><span class="o">=</span>Default
<span class="gp">$</span> <span class="nb">export</span> <span class="nv">OS_AUTH_URL</span><span class="o">=</span>http://controller:35357/v3
<span class="gp">$</span> <span class="nb">export</span> <span class="nv">OS_IDENTITY_API_VERSION</span><span class="o">=</span><span class="m">3</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">ADMIN_PASS</span></code> with the password used in the
<code class="docutils literal"><span class="pre">keystone-manage</span> <span class="pre">bootstrap</span></code> command in <a class="reference internal" href="#keystone-install-configure-ubuntu">keystone-install-configure-ubuntu</a>.</p>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Install and configure</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#install-and-configure-components">Install and configure components</a></li>
<li><a class="reference internal" href="#configure-the-apache-http-server">Configure the Apache HTTP server</a></li>
<li><a class="reference internal" href="#finalize-the-installation">Finalize the installation</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/keystone-install-ubuntu.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">doczhao 1.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, zhaoyuanjie.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.
    </div>
  </body>
</html>