<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ElasticSearch安装 &#8212; doczhao 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Haking On ElasticSearch（P-version）" href="../index-elasticsearch.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../index-elasticsearch.html" title="Haking On ElasticSearch（P-version）"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">doczhao 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index-elasticsearch.html" accesskey="U">Haking On ElasticSearch（P-version）</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="elasticsearch">
<h1>ElasticSearch安装<a class="headerlink" href="#elasticsearch" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>单机版本安装<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>安装环境：ubuntu_16.04+elasticsearch-6.2.4+java_8u191
前置条件：安装java
单机版本安装步骤
1.获取软件安装包。<a class="reference external" href="https://www.elastic.co/downloads/elasticsearch">点此获得软件包下载地址</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">当前安装测试部署阶段使用的版本为6.2.4。</p>
</div>
<p>2.解压软件包到安装目录，设置的安装目录为/opt。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span>root@ubuntu:/home/cecgw# tar -xzvf elasticsearch-6.2.4.tar.gz  -C /opt/
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>创建ES用户和组，修改文件访问权限。为了es运行安全，从5.0之后的版本禁止使用 <cite>root</cite> 用户启动es。详情可查看。<a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.6/modules-scripting-security.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.6/modules-scripting-security.html</a>.</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> groupadd elasticsearch
<span class="gp">#</span> useradd elasticsearch -g elasticsearch
<span class="gp">#</span> chown -R  elasticsearch:elasticsearch /opt/elasticsearch-6.2.4
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">First and foremost, never run Elasticsearch as the root user as this would allow any successful effort to circumvent the other security layers to do anything on your server. Elasticsearch will refuse to start if it detects that it is running as root but this is so important that it is worth double and triple checking.</p>
</div>
<ol class="arabic simple" start="4">
<li>配置ES信息。ES的配置文件在es安装目录下的config文件夹中，主要包括：elasticsearch.yml配置Elasticsearch, jvm.options配置Elasticsearch JVM设置, log4j2.properties配置Elasticsearch日志记录。</li>
</ol>
<p>elasticsearch.yml主要配置项如下：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">cluster.name: elastic-cluster-1</span>
<span class="go">node.name: elastic-cluster-1-node-1</span>
<span class="go">path.data: /opt/esdata 配置后注意该文件权限，调整为 elasticsearch执行权限。# chown -R elasticsearch:elasticsearch /opt/esdata</span>
<span class="go">path.logs: /var/log/elasticsearch 配置后注意该文件权限，调整为 elasticsearch执行权限。chown -R elasticsearch:elasticsearch /var/log/elasticsearch</span>
<span class="go">network.host: 10.10.10.10</span>
<span class="go">http.port: 9200</span>
</pre></div>
</div>
<p>设置JVM选项（包括系统属性和JVM标志）通过jvm.options配置文件，这个文件的默认位置是config/jvm.options.
jvm的配置建议，可点此查看。 <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.6/heap-size.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.6/heap-size.html</a>.
默认情况下，Elasticsearch告诉JVM使用最小和最大大小为1 GB的堆。在转移到生产环境时，重要的是配置堆大小，以确保Elasticsearch有足够的堆可用。
ES主要通过Xms (minimum heap size) 和 Xmx (maximum heap size) 配置ES堆设置。这些设置的值取决于服务器上可用RAM的数量。好的经验法则是:</p>
<ol class="arabic simple">
<li>设置最小堆大小(Xms)和最大堆大小(Xmx)相等。</li>
<li>Elasticsearch可用的堆越多，用于缓存的内存就越多。但是请注意，过多的堆会导致长时间的垃圾收集暂停。</li>
<li>将Xmx设置为不超过物理RAM的50%，以确保有足够的物理RAM留给内核文件系统缓存。</li>
</ol>
<p>jvm配置项说明可点此查看详情 <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.6/jvm-options.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.6/jvm-options.html</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">点此查看详情 <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.6/jvm-options.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.6/jvm-options.html</a>.
以-开头的行被视为独立于JVM版本的JVM选项,如 -Xmx2g。
以数字开头、后跟:、后跟-开头的行被视为只有在JVM版本与数字匹配时才适用的JVM选项，如 8:-Xmx2g。
以数字开头、后跟-、后跟:的行被视为只有当JVM版本大于或等于数字时才适用的JVM选项，如 8-:-Xmx2g。
以数字开头、后跟-、再跟数字、再跟:的行被视为只有当JVM的版本在两个数字的范围内时才适用的JVM选项，如 8-9:-Xmx2g。</p>
</div>
<p>建议根据硬件配置，以及该服务器上安装软件的情况，合理配置ES,测试电脑为6G, 设置jvm -Xms3g,-Xmx3g.</p>
<p>5. 调整操作系统参数。详情可查看`&lt;<a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.6/setting-system-settings.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.6/setting-system-settings.html</a>&gt;`_.
主要的参数为ulimit参数。在Linux系统上，可以使用ulimit临时更改资源限制。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">* soft nofile 65536</span>
<span class="go">* hard nofile 131072</span>
<span class="go">* soft nproc 2048</span>
<span class="go">* hard nproc 4096</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ubuntu忽略了这些限制。编辑/etc/pam.d/su和取消注释如下行:
# session    required   pam_limits.so</p>
</div>
<ol class="arabic simple" start="6">
<li>启动程序。切换到elasticsearch用户，启动ES.</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">su elasticsearch</span>
<span class="gp">elasticsearch@ubuntu:/opt/elasticsearch-6.2.4$</span> ./bin/elasticsearch -d
<span class="gp">elasticsearch@ubuntu:/opt/elasticsearch-6.2.4$</span> ps -aux<span class="p">|</span>grep elasti
<span class="go">root      12846  0.2  0.1  55776 11752 pts/3    S+   13:56   0:11 vi elasticsearch-install.rst</span>
<span class="go">root      13041  0.0  0.0  48908  3436 pts/7    S    15:06   0:00 su elasticsearch</span>
<span class="go">elastic+  13042  0.0  0.0  19912  3744 pts/7    S    15:06   0:00 bash</span>
<span class="go">elastic+  13099 97.9 13.7 3785592 837492 pts/7  Sl   15:07   0:09 /usr/lib/jdk/bin/java -Xms3g -Xmx3g -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.io.tmpdir=/tmp/elasticsearch.ZJf8mMJK -XX:+HeapDumpOnOutOfMemoryError -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:logs/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Des.path.home=/opt/elasticsearch-6.2.4 -Des.path.conf=/opt/elasticsearch-6.2.4/config -cp /opt/elasticsearch-6.2.4/lib/* org.elasticsearch.bootstrap.Elasticsearch -d</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li>测试验证。注意curl的ip地址为在elasticsearch.yml中配置network.host，es 9200端口仅对该IP开放，如果需要对所有的IP开放，可配置该IP为0.0.0.0.</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">elasticsearch@ubuntu:/opt/elasticsearch-6.2.4$</span> curl http://10.10.10.10:9200
<span class="go">{</span>
<span class="go">  &quot;name&quot; : &quot;elastic-cluster-1-node-1&quot;,</span>
<span class="go">  &quot;cluster_name&quot; : &quot;elastic-cluster-1&quot;,</span>
<span class="go">  &quot;cluster_uuid&quot; : &quot;9JY9--VEQ16meBv0CKFI8A&quot;,</span>
<span class="go">  &quot;version&quot; : {</span>
<span class="go">    &quot;number&quot; : &quot;6.2.4&quot;,</span>
<span class="go">    &quot;build_hash&quot; : &quot;ccec39f&quot;,</span>
<span class="go">    &quot;build_date&quot; : &quot;2018-04-12T20:37:28.497551Z&quot;,</span>
<span class="go">    &quot;build_snapshot&quot; : false,</span>
<span class="go">    &quot;lucene_version&quot; : &quot;7.2.1&quot;,</span>
<span class="go">    &quot;minimum_wire_compatibility_version&quot; : &quot;5.6.0&quot;,</span>
<span class="go">    &quot;minimum_index_compatibility_version&quot; : &quot;5.0.0&quot;</span>
<span class="go">  },</span>
<span class="go">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2>分布式安装<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pre-version。</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ElasticSearch安装</a><ul>
<li><a class="reference internal" href="#id1">单机版本安装</a></li>
<li><a class="reference internal" href="#id4">分布式安装</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../index-elasticsearch.html"
                        title="previous chapter">Haking On ElasticSearch（P-version）</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/elasticsearch/elasticsearch-install.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../index-elasticsearch.html" title="Haking On ElasticSearch（P-version）"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">doczhao 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index-elasticsearch.html" >Haking On ElasticSearch（P-version）</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, zhaoyuanjie.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.
    </div>
  </body>
</html>