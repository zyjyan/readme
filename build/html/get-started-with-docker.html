<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Get-Start Docker &#8212; doczhao 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Haking On Hadoop（P-version）" href="index-hadoop.html" />
    <link rel="prev" title="Ubuntu 安装Docker" href="docker-install-ubuntu.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="index-hadoop.html" title="Haking On Hadoop（P-version）"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="docker-install-ubuntu.html" title="Ubuntu 安装Docker"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">doczhao 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index-docker.html" accesskey="U">Haking On Docker（P-version）</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="get-start-docker">
<h1>Get-Start Docker<a class="headerlink" href="#get-start-docker" title="Permalink to this headline">¶</a></h1>
<p>在接下来的分享中，重点分享六个方面的内容：
1. 介绍Docker
2. 构建并运行第一个Docker容器
3. 将APP转换为一个扩展服务
4. 将服务扩展至多个服务集群
5. 添加一个永久保存的访问计时器
6. 将集群部署至生产环境</p>
<p>示例中的应用程序非常的简单，因此读者不必纠结于程序本身的代码. 事实上，这与Docker的理念是相同的。Docker更关注如何构建，发布以及运行应用程序，具体应用程序的复杂度，Docker是毫不关心的。</p>
<div class="section" id="id1">
<h2>概念介绍<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>image:镜像是一个轻量级的、独立的、可执行的包，它包含运行一个软件所需的所有东西，包括代码、运行时、库、环境变量和配置文件。</li>
</ol>
<p>2. Container 容器是一个映像的运行时实例，当实际执行时，映像会在内存中出现。默认情况下，它与主机环境完全隔离，只有在配置时才访问主机文件和端口。
Docker 与 VM 的比较
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
.. figure:: image/docker/vm.png</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">width:</th><td class="field-body">80%</td>
</tr>
<tr class="field-even field"><th class="field-name">align:</th><td class="field-body">center</td>
</tr>
<tr class="field-odd field"><th class="field-name">alt:</th><td class="field-body">vm</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/container.png"><img alt="container" src="_images/container.png" style="width: 80%;" /></a>
</div>
</div>
<div class="section" id="id2">
<h2>新的开发环境<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>在过去，如果您开始编写一个Python应用程序，那么您的第一项业务就是在您的机器上安装一个Python运行时。但是，这就产生了这样一种情况，你的机器上的环境必须是这样才能让你的应用程序按照预期运行;运行应用程序的服务器也是如此。</p>
<p>使用Docker，您可以只获取一个可移植的Python运行时作为映像，不需要安装。然后，您的构建可以在应用程序代码旁边包含基本的Python映像，确保您的应用程序、它的依赖项和运行时都可以一起旅行。</p>
<p>这些可移植的图像是由一个叫做Dockerfile的东西定义的.</p>
</div>
<div class="section" id="dockerfile">
<h2>使用Dockerfile定义容器<a class="headerlink" href="#dockerfile" title="Permalink to this headline">¶</a></h2>
<p>Dockerfile 定义了容器的内容。下面我们将使用一个简单的例子，学习下容器的创建过程。</p>
<p>首先，创建一个空白的目录，并创建名称为Dockerfile的文件，然后将如下内容复制到该文件中。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> Use an official Python runtime as a parent image
<span class="go">FROM python:2.7-slim</span>

<span class="gp">#</span> Set the working directory to /app
<span class="go">WORKDIR /app</span>

<span class="gp">#</span> Copy the current directory contents into the container at /app
<span class="go">ADD . /app</span>

<span class="gp">#</span> Install any needed packages specified in requirements.txt
<span class="go">RUN pip install --trusted-host pypi.python.org -r requirements.txt</span>

<span class="gp">#</span> Make port <span class="m">80</span> available to the world outside this container
<span class="go">EXPOSE 80</span>

<span class="gp">#</span> Define environment variable
<span class="go">ENV NAME World</span>

<span class="gp">#</span> Run app.py when the container launches
<span class="go">CMD [&quot;python&quot;, &quot;app.py&quot;]</span>
</pre></div>
</div>
<p>创建应用所需要的文件，requirements.txt 以及 app.py. 与Dockerfile放在相同的目录下。
这与我们的应用就创建完毕了。其中：</p>
<p>requirements.txt</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">Flask</span>
<span class="go">Redis</span>
</pre></div>
</div>
<p>app.py</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span><span class="p">,</span> <span class="n">RedisError</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="c1"># Connect to Redis</span>
<span class="n">redis</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;redis&quot;</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">socket_connect_timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">socket_timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">visits</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s2">&quot;counter&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">RedisError</span><span class="p">:</span>
        <span class="n">visits</span> <span class="o">=</span> <span class="s2">&quot;&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;&quot;</span>

    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;h3&gt;Hello {name}!&lt;/h3&gt;&quot;</span> \
           <span class="s2">&quot;&lt;b&gt;Hostname:&lt;/b&gt; {hostname}&lt;br/&gt;&quot;</span> \
           <span class="s2">&quot;&lt;b&gt;Visits:&lt;/b&gt; {visits}&quot;</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">),</span> <span class="n">hostname</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span> <span class="n">visits</span><span class="o">=</span><span class="n">visits</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="app">
<h2>构建APP<a class="headerlink" href="#app" title="Permalink to this headline">¶</a></h2>
<p>现在查看我们创建的文件:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">root@cecgw:/home/cecgw/docker/docker-app#</span> ls
<span class="go">app.py  Dockerfile  requirements.txt</span>
</pre></div>
</div>
<p>现在可以运行docker命令，构建一个Docker镜像. 我们用-t命令标记该镜像。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">docker build -t friendlyhello .</span>
<span class="go">Sending build context to Docker daemon   5.12kB</span>
<span class="go">Step 1/7 : FROM python:2.7-slim</span>
<span class="go">2.7-slim: Pulling from library/python</span>
<span class="go">c4bb02b17bb4: Pull complete</span>
<span class="go">c5c896dce5ee: Pull complete</span>
<span class="go">cf210b898cc6: Downloading [===&gt;                                               ]    983kB/14.93MB</span>
<span class="go">5117cef49bdb: Download complete</span>

<span class="go">cf210b898cc6: Pull complete</span>
<span class="go">5117cef49bdb: Pull complete</span>
<span class="go">Digest: sha256:22112f2295fe9ea84b72e5344af73a2580a47b1014a1f4c58eccf6095b7ea18f</span>
<span class="go">Status: Downloaded newer image for python:2.7-slim</span>
<span class="go"> ---&gt; 4fd30fc83117</span>
<span class="go">Step 2/7 : WORKDIR /app</span>
<span class="go">Removing intermediate container 44556fde19fe</span>
<span class="go"> ---&gt; 8fa21018e0be</span>
<span class="go">Step 3/7 : ADD . /app</span>
<span class="go"> ---&gt; f110d6b4a4ea</span>
<span class="go">Step 4/7 : RUN pip install --trusted-host pypi.python.org -r requirements.txt</span>
<span class="go"> ---&gt; Running in 1d0e54fa8dfc</span>
<span class="go">Collecting Flask (from -r requirements.txt (line 1))</span>
<span class="go">  Downloading Flask-0.12.2-py2.py3-none-any.whl (83kB)</span>
<span class="go">Collecting Redis (from -r requirements.txt (line 2))</span>
<span class="go">  Downloading redis-2.10.6-py2.py3-none-any.whl (64kB)</span>
<span class="go">Collecting itsdangerous&gt;=0.21 (from Flask-&gt;-r requirements.txt (line 1))</span>
<span class="go">  Downloading itsdangerous-0.24.tar.gz (46kB)</span>
<span class="go">Collecting Jinja2&gt;=2.4 (from Flask-&gt;-r requirements.txt (line 1))</span>
<span class="go">  Downloading Jinja2-2.10-py2.py3-none-any.whl (126kB)</span>
<span class="go">Collecting Werkzeug&gt;=0.7 (from Flask-&gt;-r requirements.txt (line 1))</span>
<span class="go">  Downloading Werkzeug-0.14.1-py2.py3-none-any.whl (322kB)</span>
<span class="go">Collecting click&gt;=2.0 (from Flask-&gt;-r requirements.txt (line 1))</span>
<span class="go">  Downloading click-6.7-py2.py3-none-any.whl (71kB)</span>
<span class="go">Collecting MarkupSafe&gt;=0.23 (from Jinja2&gt;=2.4-&gt;Flask-&gt;-r requirements.txt (line 1))</span>
<span class="go">  Downloading MarkupSafe-1.0.tar.gz</span>
<span class="go">Building wheels for collected packages: itsdangerous, MarkupSafe</span>
<span class="go">  Running setup.py bdist_wheel for itsdangerous: started</span>
<span class="go">  Running setup.py bdist_wheel for itsdangerous: finished with status &#39;done&#39;</span>
<span class="go">  Stored in directory: /root/.cache/pip/wheels/fc/a8/66/24d655233c757e178d45dea2de22a04c6d92766abfb741129a</span>
<span class="go">  Running setup.py bdist_wheel for MarkupSafe: started</span>
<span class="go">  Running setup.py bdist_wheel for MarkupSafe: finished with status &#39;done&#39;</span>
<span class="go">  Stored in directory: /root/.cache/pip/wheels/88/a7/30/e39a54a87bcbe25308fa3ca64e8ddc75d9b3e5afa21ee32d57</span>
<span class="go">Successfully built itsdangerous MarkupSafe</span>
<span class="go">Installing collected packages: itsdangerous, MarkupSafe, Jinja2, Werkzeug, click, Flask, Redis</span>
<span class="go">Successfully installed Flask-0.12.2 Jinja2-2.10 MarkupSafe-1.0 Redis-2.10.6 Werkzeug-0.14.1 click-6.7 itsdangerous-0.24</span>
<span class="go">Removing intermediate container 1d0e54fa8dfc</span>
<span class="go"> ---&gt; 964c9a2ff5ac</span>
<span class="go">Step 5/7 : EXPOSE 80</span>
<span class="go"> ---&gt; Running in f136af4ed15f</span>
<span class="go">Removing intermediate container f136af4ed15f</span>
<span class="go"> ---&gt; 9fe081fc05a0</span>
<span class="go">Step 6/7 : ENV NAME World</span>
<span class="go"> ---&gt; Running in ae4dee9777e3</span>
<span class="go">Removing intermediate container ae4dee9777e3</span>
<span class="go"> ---&gt; 9de5dff3a988</span>
<span class="go">Step 7/7 : CMD [&quot;python&quot;, &quot;app.py&quot;]</span>
<span class="go"> ---&gt; Running in 61a41aa26178</span>
<span class="go">Removing intermediate container 61a41aa26178</span>
<span class="go"> ---&gt; e8aafca68713</span>
<span class="go">Successfully built e8aafca68713</span>
<span class="go">Successfully tagged friendlyhello:latest</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>运行容器<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>执行DOCKER运行命令，前台执行命令：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">docker run -p 4000:80 friendlyhello</span>
</pre></div>
</div>
<p>后台执行命令：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">docker run -d -p 4000:80 friendlyhello</span>
</pre></div>
</div>
<p>查看容器运行状态：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> docker container ls
<span class="go">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                  NAMES</span>
<span class="go">621fa271fc72        friendlyhello       &quot;python app.py&quot;     44 seconds ago      Up 43 seconds       0.0.0.0:4000-&gt;80/tcp   jovial_morse</span>
</pre></div>
</div>
<p>结束容器运行命令：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> docker container stop 621fa271fc72
<span class="go">  621fa271fc72</span>
</pre></div>
</div>
<p>容器运行成功后，可以访问浏览器，<a class="reference external" href="http://ip:4000">http://ip:4000</a>,可以查看浏览器响应。也可以在本地使用
curl命令进行查看。</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> curl http://localhost:4000
<span class="go">&lt;h3&gt;Hello World!&lt;/h3&gt;&lt;b&gt;Hostname:&lt;/b&gt; 598cc14f4c28&lt;br/&gt;&lt;b&gt;Visits:&lt;/b&gt; &lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2>分享镜像<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>测试成功后，我们可以将我们制作的镜像上传至云端。前提是需要到官网上进行注册。
<a class="reference external" href="https://cloud.docker.com">注册地址</a>.</p>
<dl class="docutils">
<dt>本地登录</dt>
<dd>注册后，在本地终端进行登录：</dd>
</dl>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">root@cecgw:/home/cecgw/github/readme/source#</span> docker login
<span class="go">Login with your Docker ID to push and pull images from Docker Hub. If you don&#39;t have a Docker ID, head over to https://hub.docker.com to create one.</span>
<span class="go">Username: oneandonly</span>
<span class="go">Password:</span>
<span class="go">Login Succeeded</span>
</pre></div>
</div>
<dl class="docutils">
<dt>标注镜像</dt>
<dd>终端执行命令如下:</dd>
</dl>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> docker tag friendlyhello oneandonly/friendlyhello-2018.1.25
</pre></div>
</div>
<p>终端查看标记过的镜像：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> docker image list
<span class="go">REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE</span>
<span class="go">friendlyhello                        latest              e8aafca68713        2 hours ago         148MB</span>
<span class="go">oneandonly/friendlyhello-2018.1.25   latest              e8aafca68713        2 hours ago         148MB</span>
<span class="go">python                               2.7-slim            4fd30fc83117        6 weeks ago         138MB</span>
<span class="go">hello-world                          latest              f2a91732366c        2 months ago        1.85kB</span>
</pre></div>
</div>
<dl class="docutils">
<dt>发布镜像</dt>
<dd>终端执行如下命令：</dd>
</dl>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> docker push oneandonly/friendlyhello-2018.1.25
<span class="go">The push refers to repository [docker.io/oneandonly/friendlyhello-2018.1.25]</span>
<span class="go">bf01cd042702: Pushed</span>
<span class="go">baa35828d3ce: Pushed</span>
<span class="go">63bfc4b63764: Pushed</span>
<span class="go">94b0b6f67798: Mounted from library/python</span>
<span class="go">e0c374004259: Mounted from library/python</span>
<span class="go">56ee7573ea0f: Mounted from library/python</span>
<span class="go">cfce7a8ae632: Mounted from library/python</span>
<span class="go">latest: digest: sha256:beb1aac4e2df9da53e89c0fc4deb90d7224464734f3ce1a1545b7d08af13b3fc size: 1787</span>
</pre></div>
</div>
<p>如果该映像在本地无法使用，那么Docker将从存储库中拉出它。
执行命令为:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">docker run -p 4000:80 oneandonly/friendlyhello-2018.1.25</span>
</pre></div>
</div>
<p>无论 <code class="docutils literal"><span class="pre">docker</span> <span class="pre">run</span></code> 命令在哪里执行，它都会拉出镜像，并包含响应的python环境，以及requirements里的依赖。并运行的代码。它都是在一个整洁的小包裹里一起旅行的，而且主机不需要安装任何东西，而只是Docker来运行它。</p>
</div>
<div class="section" id="docker">
<h2>Docker 服务<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h2>
<p>前面已经介绍了容器的内容，现在介绍下Services.
在分布式应用中，不同的组件提供不同的服务。服务实际上只是“生产中的容器”。“一个服务只运行一个镜像，但是它将图像的运行方式,如应该使用的端口、应该运行多少个容器的副本、以便服务具有它需要的容量等等进行了整理。扩展服务会改变运行该软件的容器实例的数量，在流程中为服务分配更多的计算资源
。
通过docker实现服务的定义、运行以及扩展非常便利。只需要编写一个 <code class="docutils literal"><span class="pre">docker-compose.yml</span></code> 文件即可。</p>
<p>docker-compose.yml 文件定义了Docker容器的在生成中的行为。</p>
<p>我们定义如下docker-compose.yml 文件.</p>
<div class="highlight-yml"><div class="highlight"><pre><span></span>version: &quot;3&quot;
services:
  web:
    # replace username/repo:tag with your name and image details
    image: oneandonly/friendlyhello-2018.1.25
    deploy:
      replicas: 5
      resources:
        limits:
          cpus: &quot;0.1&quot;
          memory: 50M
      restart_policy:
        condition: on-failure
    ports:
      - &quot;80:80&quot;
    networks:
      - webnet
networks:
  webnet:
</pre></div>
</div>
<p>改文件在docker平台上执行后，会做出如下动作：</p>
<ol class="arabic simple">
<li>从Docker云端将image镜像进行下载;</li>
<li>运行5个镜像实例作为服务，服务名称为 <code class="docutils literal"><span class="pre">web</span></code>. 规定每一个容器最多只能使用10% CPU, 50M内存.</li>
<li>如果出现故障，立即重启Docker；</li>
<li>映射host与服务 <code class="docutils literal"><span class="pre">web</span></code> 端口为 80:80.</li>
<li>将5个containers通过负载均衡网络webnet共享80端口。在容器内部，通过一个临时端口发布到web服务的80端口。</li>
<li>定义webnet网络，使用默认的设置.</li>
</ol>
</div>
<div class="section" id="id6">
<h2>运行新的负载均衡APP<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>1. 终端执行 docker swarm init &#8211;advertise-addr br-ex
.. code-block:: console</p>
<blockquote>
<div><p># docker swarm init &#8211;advertise-addr br-ex
Swarm initialized: current node (crn8foamx5e8io1ff5n22ofo2) is now a manager.</p>
<p>To add a worker to this swarm, run the following command:</p>
<blockquote>
<div>docker swarm join &#8211;token SWMTKN-1-3fhsrnwgs36nqgv4yce62rmqsmifbxcya4q0obllmwbvpuvznd-3d47jfab15ocbqea003ho6c7f 192.168.246.132:2377</div></blockquote>
<p>To add a manager to this swarm, run &#8216;docker swarm join-token manager&#8217; and follow the instructions.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>终端执行 docker stack deploy -c docker-compose.yml getstartedlab 需要给运行的APP一个名字，此名字定义为getstartedlab:</li>
</ol>
<p>这样，我们的一个服务栈已经运行了5个容器实例，在同一个物理服务器中.</p>
<ol class="arabic simple" start="3">
<li>查看服务.docker service ls</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">root@cecgw:/home/cecgw/docker#</span> docker service ls
<span class="go">ID                  NAME                MODE                REPLICAS            IMAGE                                       PORTS</span>
<span class="go">lvk1pm89vphp        getstartedlab_web   replicated          5/5                 oneandonly/friendlyhello-2018.1.25:latest   *:80-&gt;80/tcp</span>
</pre></div>
</div>
<p>终端查看docker容器状态。 docker container list</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">root@cecgw:/home/cecgw/docker#</span> docker container list
<span class="go">CONTAINER ID        IMAGE                                       COMMAND             CREATED             STATUS              PORTS               NAMES</span>
<span class="go">36e0ee067b48        oneandonly/friendlyhello-2018.1.25:latest   &quot;python app.py&quot;     8 seconds ago       Up 2 seconds        80/tcp              getstartedlab_web.5.dknj99kg8z27tmcmr5d3stl37</span>
<span class="go">571267336cfb        oneandonly/friendlyhello-2018.1.25:latest   &quot;python app.py&quot;     18 seconds ago      Up 7 seconds        80/tcp              getstartedlab_web.3.zt9nqi5u1tgu2kqcyytzh056c</span>
<span class="go">8c2bb1d05b28        oneandonly/friendlyhello-2018.1.25:latest   &quot;python app.py&quot;     33 seconds ago      Up 17 seconds       80/tcp              getstartedlab_web.4.y5m10kvjhhybgi7ceephy70sv</span>
<span class="go">d0d9cd2d925d        oneandonly/friendlyhello-2018.1.25:latest   &quot;python app.py&quot;     41 seconds ago      Up 32 seconds       80/tcp              getstartedlab_web.2.p7a0dwxjn4d4ans3yihnbugss</span>
<span class="go">a94bea1c0879        oneandonly/friendlyhello-2018.1.25:latest   &quot;python app.py&quot;     52 seconds ago      Up 41 seconds       80/tcp</span>
</pre></div>
</div>
<p>安装方式包括两种，一种为APT安装，一种是通过DEB包安装。</p>
<p>APT安装</p>
<p>deb包安装</p>
<p>用户可以到 <a class="reference external" href="https://download.docker.com/linux/ubuntu/dists/trusty/">Docker源选取合适的包下载安装</a>.
下载后，使用如下命令进行安装：
.. code-block:: console</p>
<blockquote>
<div><a class="reference external" href="mailto:root&#37;&#52;&#48;cecgw">root<span>&#64;</span>cecgw</a>:/home/cecgw# dpkg -i docker-ce_17.12.0~ce-0~ubuntu_amd64.deb</div></blockquote>
<p>首次执行后，发现出现报错信息如下:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">root@cecgw:/home/cecgw#</span>  dpkg -i docker-ce_17.12.0~ce-0~ubuntu_amd64.deb
<span class="go">(Reading database ... 134914 files and directories currently installed.)</span>
<span class="go">Preparing to unpack docker-ce_17.12.0~ce-0~ubuntu_amd64.deb ...</span>
<span class="go">Unpacking docker-ce (17.12.0~ce-0~ubuntu) over (17.12.0~ce-0~ubuntu) ...</span>
<span class="go">dpkg: dependency problems prevent configuration of docker-ce:</span>
<span class="go">docker-ce depends on libsystemd-journal0 (&gt;= 201); however:</span>
<span class="go">Package libsystemd-journal0 is not installed.</span>

<span class="go">dpkg: error processing package docker-ce (--install):</span>
<span class="go">dependency problems - leaving unconfigured</span>
<span class="go">Processing triggers for ureadahead (0.100.0-16) ...</span>
<span class="go">Processing triggers for man-db (2.6.7.1-1ubuntu1) ...</span>
<span class="go">Errors were encountered while processing:</span>
<span class="go">docker-ce</span>
</pre></div>
</div>
<p>发现系统中缺少依赖，关于依赖的问题，确实是在软件部署及升级过程中，非常头痛的问题，Docker也是在着重解决该问题。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这里给大家普及下，如何找到相关的依赖，<a class="reference external" href="https://pkgs.org/">站点 https://pkgs.org/</a> 中提供了linux中大部分的软件包，
大家可以在此网站上，选取适合自己的操作系统版本，并搜索下载相关的软件包。</p>
</div>
<p>下载完成后，先安装相关的依赖，然后完成Docker相关的软件安装即可。我们查看系统用户组，<cite>/etc/group`发现多出系统用户组docker，但查看</cite>/etc/passwd`，并没有发现多出docker用户。</p>
<p>下载完成后，我们可以使用如下命令验证Docker安装是否成功：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">docker run hello-world</span>
<span class="go">Unable to find image &#39;hello-world:latest&#39; locally</span>
<span class="go">latest: Pulling from library/hello-world</span>
<span class="go">ca4f61b1923c: Pull complete</span>
<span class="go">Digest: sha256:66ef312bbac49c39a89aa9bcc3cb4f3c9e7de3788c944158df3ee0176d32b751</span>
<span class="go">Status: Downloaded newer image for hello-world:latest</span>

<span class="go">Hello from Docker!</span>
<span class="go">This message shows that your installation appears to be working correctly.</span>

<span class="go">To generate this message, Docker took the following steps:</span>
<span class="go"> 1. The Docker client contacted the Docker daemon.</span>
<span class="go"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span>
<span class="go">    (amd64)</span>
<span class="go"> 3. The Docker daemon created a new container from that image which runs the</span>
<span class="go">    executable that produces the output you are currently reading.</span>
<span class="go"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span>
<span class="go">    to your terminal.</span>

<span class="go">To try something more ambitious, you can run an Ubuntu container with:</span>
<span class="gp"> $</span> docker run -it ubuntu bash

<span class="go">Share images, automate workflows, and more with a free Docker ID:</span>
<span class="go"> https://cloud.docker.com/</span>

<span class="go">For more examples and ideas, visit:</span>
<span class="go"> https://docs.docker.com/engine/userguide/</span>
</pre></div>
</div>
<p>该命令，将下载一个测试镜像，并且启动容器；该测试容器将打印Hello from Docker. 并且退出，似乎我们已经运行了一个容器，但对于其原理及用途扔不是很清晰。带着疑问继续研究。
具体到Docker自身，我们需要观察，Docker运行的一些基本元素，比如，是否只有root用户权限可操作？是否绑定系统端口？是否跟随系统自启动？等一系列的问题，这个将在随后的章节给出答案。</p>
</div>
<div class="section" id="docker-ce">
<h2>卸载DOCKER CE<a class="headerlink" href="#docker-ce" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>卸载相关软件包:</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> sudo apt-get purge docker-ce
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>删除相关的镜像，容器，卷：</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> sudo rm -rf /var/lib/docker
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/docker-1.png"><img alt="Docker-1" src="_images/docker-1.png" style="width: 80%;" /></a>
</div>
<p>end-21</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Get-Start Docker</a><ul>
<li><a class="reference internal" href="#id1">概念介绍</a></li>
<li><a class="reference internal" href="#id2">新的开发环境</a></li>
<li><a class="reference internal" href="#dockerfile">使用Dockerfile定义容器</a></li>
<li><a class="reference internal" href="#app">构建APP</a></li>
<li><a class="reference internal" href="#id3">运行容器</a></li>
<li><a class="reference internal" href="#id4">分享镜像</a></li>
<li><a class="reference internal" href="#docker">Docker 服务</a></li>
<li><a class="reference internal" href="#id6">运行新的负载均衡APP</a></li>
<li><a class="reference internal" href="#docker-ce">卸载DOCKER CE</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="docker-install-ubuntu.html"
                        title="previous chapter">Ubuntu 安装Docker</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="index-hadoop.html"
                        title="next chapter">Haking On Hadoop（P-version）</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/get-started-with-docker.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="index-hadoop.html" title="Haking On Hadoop（P-version）"
             >next</a> |</li>
        <li class="right" >
          <a href="docker-install-ubuntu.html" title="Ubuntu 安装Docker"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">doczhao 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index-docker.html" >Haking On Docker（P-version）</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, zhaoyuanjie.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.
    </div>
  </body>
</html>